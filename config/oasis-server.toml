[nats]
# NATS 服务器连接地址
url = "tls://localhost:4443"
# NATS 连接配置
creds_file = "certs/nats.creds"
tls_ca_file = "certs/nats-ca.pem"
tls_cert_file = "certs/nats-client.pem"
tls_key_file = "certs/nats-client-key.pem"

[telemetry]
# 日志级别: trace, debug, info, warn, error
log_level = "info"
# 日志格式: json, pretty
log_format = "text"
# 禁用 ANSI 颜色输出
log_no_ansi = false

[server]
# gRPC 服务监听地址
grpc_addr = "127.0.0.1:50051"
# Agent 心跳 TTL (秒) - 应该是 Agent 心跳间隔的 2-3 倍
heartbeat_ttl_sec = 90

[server.grpc_tls]
# CA 证书路径（用于验证客户端证书）
ca_cert = "certs/grpc-ca.pem"
# 服务器证书路径
server_cert = "certs/grpc-server.pem"
# 服务器私钥路径
server_key = "certs/grpc-server-key.pem"
# 证书文件检查间隔（秒，用于热重载）
cert_check_interval_sec = 300

# ==============================================
# JetStream 配置部分
# ==============================================

[streams]

[streams.tasks]
# 任务 Stream - 存储待执行的任务
max_age_sec = 86400    # 统一使用 max_age_sec
max_msgs = 1000000     # 统一使用 max_msgs
max_bytes = 1000000000
max_msg_size = 1048576 # 1MB
storage = "file"
replicas = 1

[streams.results]
# 结果 Stream - 存储任务执行结果
max_age_sec = 604800   # 7 days
max_msgs = 10000000    # 10M messages
max_bytes = 5000000000 # 5GB
max_msg_size = 1048576 # 1MB
storage = "file"
replicas = 1

[streams.rollouts]
# 灰度发布 Stream 
max_age_sec = 86400    # 1 day
max_msgs = 1000000
max_bytes = 1000000000
max_msg_size = 1048576
storage = "file"
replicas = 1

[streams.dlq]
# DLQ 
max_age_sec = 2592000 # 30 days
max_msgs = 100000
max_bytes = 100000000 # 100MB

[streams.artifacts]
# 对象存储
max_age_sec = 86400
max_bytes = 10737418240 # 10GB
storage = "file"
replicas = 1

[streaming]
# 流式处理配置
max_retries = 3
initial_poll_interval_ms = 50
max_poll_interval_ms = 500
empty_results_threshold = 5

[kv]
# KV 存储配置
max_value_size = 65536 # 64KB
facts_history = 50
labels_history = 50

[publish]
# 发布限流与重试配置
max_publishes_per_sec = 100
max_retries = 3
initial_retry_delay_ms = 100
max_retry_delay_ms = 5000
